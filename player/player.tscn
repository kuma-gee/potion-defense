[gd_scene load_steps=42 format=3 uid="uid://dsjo3xx3s5pje"]

[ext_resource type="Script" uid="uid://c6wwca7h8xf7f" path="res://player/player.gd" id="1_4flbx"]
[ext_resource type="Script" uid="uid://ceanc8yrpv7ov" path="res://player/player_animation.gd" id="2_qjkh3"]
[ext_resource type="PackedScene" uid="uid://olicgb1t6k84" path="res://assets/models/runner/runner.glb" id="2_yw30f"]
[ext_resource type="Script" uid="uid://ch1gifjud7map" path="res://player/player_view_controller.gd" id="3_yw30f"]
[ext_resource type="Script" uid="uid://di0mgt87hfkk6" path="res://player/states/move.gd" id="5_yllr7"]
[ext_resource type="Script" uid="uid://bx3a0klh2slmp" path="res://player/states/dash.gd" id="6_2ieo8"]
[ext_resource type="Material" uid="uid://bhte32yr5w1n7" path="res://player/body_mat.tres" id="6_g6k8r"]
[ext_resource type="Material" uid="uid://cml2p3oqube1s" path="res://player/face_mat.tres" id="7_boad6"]
[ext_resource type="Script" uid="uid://c47cerucvqs22" path="res://player/states/knockbacked.gd" id="7_ebec5"]
[ext_resource type="Script" uid="uid://c1agy1l74jb0j" path="res://util/FrameFreeze.gd" id="7_wodsf"]
[ext_resource type="Script" uid="uid://5fkvv50lqbl8" path="res://player/dodge_area.gd" id="8_rgyib"]
[ext_resource type="Script" uid="uid://bigqmro10vuly" path="res://player/states/dead.gd" id="8_yllr7"]
[ext_resource type="Script" uid="uid://yp8jmq5o37s5" path="res://player/states/state_machine.gd" id="9_hg6s5"]
[ext_resource type="Script" uid="uid://cdj7du7ubtond" path="res://player/stamina.gd" id="13_yllr7"]
[ext_resource type="Script" uid="uid://cr3qlwd21vb4k" path="res://player/stamina_bar.gd" id="14_kb6p2"]
[ext_resource type="Shader" uid="uid://br5iefff7slht" path="res://obstacles/helper/lock_circle.gdshader" id="15_32hag"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ebec5"]
animation = &"Sprinting Forward Roll"
use_custom_timeline = true
timeline_length = 1.0
stretch_time_scale = true
start_offset = 0.0
loop_mode = 0

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_boad6"]
animation = &"Getting Hit"
use_custom_timeline = true
timeline_length = 0.8
stretch_time_scale = true
start_offset = 0.20000000000000284
loop_mode = 0

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_yllr7"]
fadein_time = 0.2
fadeout_time = 0.2

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_boad6"]
fadein_time = 0.2
fadeout_time = 0.2

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_yw30f"]
animation = &"Idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_hg6s5"]
animation = &"Running Turn 180"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_qjkh3"]
animation = &"Running"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_8t03j"]
animation = &"Standard Run"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_g6k8r"]
animation = &"Run To Stop"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_rgyib"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_hg6s5"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "has_motion()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_8t03j"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "!has_motion()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2ieo8"]
xfade_time = 0.2
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ebec5"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "has_motion()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_wodsf"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "not has_motion()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_32hag"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "sprinting"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_tqiix"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "not sprinting"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_e7oew"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "is_turning() and has_motion()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_c35mf"]
xfade_time = 0.2
switch_mode = 2
advance_mode = 2
advance_expression = "not is_turning() and has_motion()"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_32hag"]
states/End/position = Vector2(943, 100)
states/Idle/node = SubResource("AnimationNodeAnimation_yw30f")
states/Idle/position = Vector2(364, 49)
states/Running/node = SubResource("AnimationNodeAnimation_qjkh3")
states/Running/position = Vector2(552, 49)
"states/Running Turn 180/node" = SubResource("AnimationNodeAnimation_hg6s5")
"states/Running Turn 180/position" = Vector2(742, 149)
"states/Standard Run/node" = SubResource("AnimationNodeAnimation_8t03j")
"states/Standard Run/position" = Vector2(742, 49)
states/Stop/node = SubResource("AnimationNodeAnimation_g6k8r")
states/Stop/position = Vector2(497, 143)
transitions = ["Start", "Idle", SubResource("AnimationNodeStateMachineTransition_rgyib"), "Idle", "Running", SubResource("AnimationNodeStateMachineTransition_hg6s5"), "Running", "Stop", SubResource("AnimationNodeStateMachineTransition_8t03j"), "Stop", "Idle", SubResource("AnimationNodeStateMachineTransition_2ieo8"), "Stop", "Running", SubResource("AnimationNodeStateMachineTransition_ebec5"), "Running Turn 180", "Stop", SubResource("AnimationNodeStateMachineTransition_wodsf"), "Running", "Standard Run", SubResource("AnimationNodeStateMachineTransition_32hag"), "Standard Run", "Running", SubResource("AnimationNodeStateMachineTransition_tqiix"), "Standard Run", "Running Turn 180", SubResource("AnimationNodeStateMachineTransition_e7oew"), "Running Turn 180", "Standard Run", SubResource("AnimationNodeStateMachineTransition_c35mf")]
graph_offset = Vector2(-110, -63)

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_yw30f"]
graph_offset = Vector2(-519.9109, 81.505585)
nodes/output/position = Vector2(800, 140)
nodes/Move/node = SubResource("AnimationNodeStateMachine_32hag")
nodes/Move/position = Vector2(-120, 120)
nodes/Hit/node = SubResource("AnimationNodeOneShot_boad6")
nodes/Hit/position = Vector2(280, 120)
nodes/Animation/node = SubResource("AnimationNodeAnimation_boad6")
nodes/Animation/position = Vector2(0, 340)
nodes/Dodge/node = SubResource("AnimationNodeOneShot_yllr7")
nodes/Dodge/position = Vector2(600, 160)
"nodes/Animation 2/node" = SubResource("AnimationNodeAnimation_ebec5")
"nodes/Animation 2/position" = Vector2(260, 440)
node_connections = [&"output", 0, &"Dodge", &"Hit", 0, &"Move", &"Hit", 1, &"Animation", &"Dodge", 0, &"Hit", &"Dodge", 1, &"Animation 2"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_sh265"]
radius = 0.08
height = 0.78808594

[sub_resource type="CylinderShape3D" id="CylinderShape3D_g1dw6"]
height = 0.6
radius = 0.1

[sub_resource type="SphereShape3D" id="SphereShape3D_boad6"]
radius = 0.55

[sub_resource type="ShaderMaterial" id="ShaderMaterial_tqiix"]
shader = ExtResource("15_32hag")
shader_parameter/radius = 0.250000011875
shader_parameter/smoothness = 0.0800000038

[node name="Player" type="CharacterBody3D"]
collision_layer = 2
script = ExtResource("1_4flbx")

[node name="PlayerAnimation" type="AnimationTree" parent="."]
root_node = NodePath("../BodyRoot/runner")
tree_root = SubResource("AnimationNodeBlendTree_yw30f")
anim_player = NodePath("../BodyRoot/runner/AnimationPlayer")
parameters/Hit/active = false
parameters/Hit/internal_active = false
parameters/Hit/request = 0
parameters/Dodge/active = false
parameters/Dodge/internal_active = false
parameters/Dodge/request = 0
script = ExtResource("2_qjkh3")

[node name="PlayerViewController" type="Node" parent="." node_paths=PackedStringArray("target_lock_circle", "body", "camera_root", "camera")]
script = ExtResource("3_yw30f")
target_lock_circle = NodePath("../CanvasLayer/Control/TargetLock")
body = NodePath("../BodyRoot")
camera_root = NodePath("../CameraRoot")
camera = NodePath("../CameraRoot/Pivot/Camera3D")
metadata/_custom_type_script = "uid://ch1gifjud7map"

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("9_hg6s5")
initial_state = NodePath("Move")
metadata/_custom_type_script = "uid://yp8jmq5o37s5"

[node name="Move" type="Node" parent="StateMachine" node_paths=PackedStringArray("player", "dash_state", "knockback_state")]
script = ExtResource("5_yllr7")
player = NodePath("../..")
dash_state = NodePath("../Dash")
knockback_state = NodePath("../Knockbacked")
metadata/_custom_type_script = "uid://g325vyi3fud1"

[node name="Dash" type="Node" parent="StateMachine" node_paths=PackedStringArray("player", "dodge_area", "animation", "frame_freeze")]
script = ExtResource("6_2ieo8")
player = NodePath("../..")
dodge_area = NodePath("../../DodgeArea")
speed = 15.0
deaccel = 4.0
animation = NodePath("../../PlayerAnimation")
frame_freeze = NodePath("FrameFreeze")
metadata/_custom_type_script = "uid://g325vyi3fud1"

[node name="FrameFreeze" type="Node" parent="StateMachine/Dash"]
script = ExtResource("7_wodsf")
time_scale = 0.2
metadata/_custom_type_script = "uid://c1agy1l74jb0j"

[node name="Knockbacked" type="Node" parent="StateMachine" node_paths=PackedStringArray("player", "animation", "frame_freeze")]
script = ExtResource("7_ebec5")
player = NodePath("../..")
animation = NodePath("../../PlayerAnimation")
frame_freeze = NodePath("FrameFreeze")
metadata/_custom_type_script = "uid://g325vyi3fud1"

[node name="FrameFreeze" type="Node" parent="StateMachine/Knockbacked"]
script = ExtResource("7_wodsf")
metadata/_custom_type_script = "uid://c1agy1l74jb0j"

[node name="Dead" type="Node" parent="StateMachine" node_paths=PackedStringArray("character")]
script = ExtResource("8_yllr7")
character = NodePath("../..")
metadata/_custom_type_script = "uid://g325vyi3fud1"

[node name="BodyRoot" type="Node3D" parent="."]

[node name="runner" parent="BodyRoot" instance=ExtResource("2_yw30f")]
transform = Transform3D(-0.5, 0, -4.371139e-08, 0, 0.5, 0, 4.371139e-08, 0, -0.5, 0, 0, 0)

[node name="Skeleton3D" parent="BodyRoot/runner/Armature_002" index="0"]
bones/0/position = Vector3(-0.0005512108, 1.7952071e-09, 0.015059289)
bones/1/position = Vector3(0.0016498821, 0.92377436, 0.011672793)
bones/1/rotation = Quaternion(-0.008432986, 0.013427375, -0.042751435, 0.99895996)
bones/2/rotation = Quaternion(-0.034181952, -0.012048294, 0.02162471, 0.999109)
bones/3/rotation = Quaternion(0.006340619, -0.0027324283, 0.05183439, 0.9986319)
bones/4/rotation = Quaternion(0.0064117005, 0.0018523731, 0.051464077, 0.9986526)
bones/5/rotation = Quaternion(0.054230176, -0.00163508, -0.01900021, 0.9983464)
bones/6/rotation = Quaternion(0.013343262, 0.0055933697, -0.07109263, 0.99736476)
bones/8/rotation = Quaternion(-0.63571316, -0.3924507, 0.48726118, -0.45213705)
bones/9/rotation = Quaternion(0.6010286, -0.0031746305, -0.10783942, 0.7919124)
bones/10/rotation = Quaternion(0.03190167, -0.0020360593, 0.14338663, 0.98915035)
bones/11/rotation = Quaternion(0.0034321109, 0.91181755, -0.17163263, 0.3729871)
bones/12/rotation = Quaternion(-0.16782519, -0.009628527, 0.1654819, 0.9717808)
bones/13/rotation = Quaternion(-0.121874094, 0.11172156, 0.071566716, 0.9836378)
bones/14/rotation = Quaternion(-0.057091016, 0.06274989, 0.026831158, 0.9960337)
bones/16/rotation = Quaternion(0.58757234, -0.44444984, 0.5352785, 0.41315868)
bones/17/rotation = Quaternion(0.48977897, 0.0062109046, 0.035289105, 0.8711101)
bones/18/rotation = Quaternion(0.034017798, 0.0027287286, -0.16365673, 0.9859269)
bones/19/rotation = Quaternion(-0.10958424, 0.9140643, -0.25771782, -0.29335883)
bones/20/rotation = Quaternion(0.08743858, 0.9156193, -0.37942412, 0.10016602)
bones/21/rotation = Quaternion(0.15815733, -0.049861524, 0.07041493, 0.9836371)
bones/22/rotation = Quaternion(0.115115374, -0.017369062, 0.03150525, 0.99270046)
bones/24/rotation = Quaternion(0.11776607, 0.1470211, 0.97415364, -0.12466238)
bones/25/rotation = Quaternion(-0.21644771, -0.0776001, 0.017141659, 0.9730544)
bones/26/rotation = Quaternion(0.5078817, -0.092487365, -0.06291909, 0.8541332)
bones/27/rotation = Quaternion(0.3022234, 0.011227907, -0.00366585, 0.9531639)
bones/29/rotation = Quaternion(-0.038809374, -0.013192091, 0.9954636, -0.08586043)
bones/30/rotation = Quaternion(-0.08303858, 0.047770817, 0.0443056, 0.99441427)
bones/31/rotation = Quaternion(0.5149748, -0.005553637, -0.074431434, 0.8539498)
bones/32/rotation = Quaternion(0.34052238, -0.016647084, 0.0061510163, 0.94006896)

[node name="Body" parent="BodyRoot/runner/Armature_002/Skeleton3D" index="0"]
surface_material_override/0 = ExtResource("6_g6k8r")

[node name="Face" parent="BodyRoot/runner/Armature_002/Skeleton3D" index="1"]
surface_material_override/0 = ExtResource("7_boad6")

[node name="Body" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.40391627, 0)
shape = SubResource("CapsuleShape3D_sh265")

[node name="Hurtbox" type="Area3D" parent="Body"]
visible = false
collision_layer = 4
collision_mask = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="Body/Hurtbox"]
shape = SubResource("CylinderShape3D_g1dw6")

[node name="CSGCylinder3D" type="CSGCylinder3D" parent="Body"]
visible = false
radius = 0.1
height = 0.6

[node name="CameraRoot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.6827016, 0)

[node name="Pivot" type="SpringArm3D" parent="CameraRoot"]
spring_length = 2.0

[node name="Camera3D" type="Camera3D" parent="CameraRoot/Pivot"]
current = true

[node name="DodgeArea" type="Area3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.4096583, 0)
collision_layer = 2
collision_mask = 4
script = ExtResource("8_rgyib")

[node name="CollisionShape3D" type="CollisionShape3D" parent="DodgeArea"]
shape = SubResource("SphereShape3D_boad6")

[node name="Stamina" type="Node" parent="." node_paths=PackedStringArray("recovery_start_timer")]
script = ExtResource("13_yllr7")
recovery_start_timer = NodePath("RecoverStart")
metadata/_custom_type_script = "uid://cdj7du7ubtond"

[node name="RecoverStart" type="Timer" parent="Stamina"]
one_shot = true

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Control" type="Control" parent="CanvasLayer"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="TargetLock" type="ColorRect" parent="CanvasLayer/Control"]
material = SubResource("ShaderMaterial_tqiix")
custom_minimum_size = Vector2(16, 16)
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -8.0
offset_top = -8.0
offset_right = 8.0
offset_bottom = 8.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="MarginContainer" type="MarginContainer" parent="CanvasLayer/Control"]
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -100.0
offset_top = -12.0
offset_right = 100.0
grow_horizontal = 2
grow_vertical = 0
theme_override_constants/margin_bottom = 8

[node name="StaminaBar" type="ProgressBar" parent="CanvasLayer/Control/MarginContainer" node_paths=PackedStringArray("stamina")]
custom_minimum_size = Vector2(250, 16)
layout_mode = 2
size_flags_vertical = 1
show_percentage = false
script = ExtResource("14_kb6p2")
stamina = NodePath("../../../../Stamina")

[editable path="BodyRoot/runner"]
